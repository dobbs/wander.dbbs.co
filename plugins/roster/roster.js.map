{
  "version": 3,
  "names": [
    "bind",
    "emit",
    "escape",
    "includes",
    "load_sites",
    "parse",
    "text",
    "replace",
    "uri",
    "results",
    "site",
    "tuples",
    "split",
    "length",
    "shift",
    "wiki",
    "neighborhoodObject",
    "registerNeighbor",
    "$item",
    "item",
    "cat",
    "category",
    "expand",
    "flag",
    "includeReferences",
    "includeRoster",
    "lines",
    "lineup",
    "marks",
    "more",
    "newline",
    "roster",
    "all",
    "addClass",
    "get",
    "getRoster",
    "br",
    "push",
    "concat",
    "j",
    "len",
    "sites",
    "_ref",
    "join",
    "name",
    "line",
    "siteslug",
    "slug",
    "unshift",
    "apply",
    "_siteslug$split",
    "_siteslug$split2",
    "_slicedToArray",
    "error",
    "page",
    "i",
    "ref",
    "console",
    "log",
    "story",
    "type",
    "empty",
    "_siteslug$split3",
    "_siteslug$split4",
    "indexOf",
    "append",
    "on",
    "e",
    "shiftKey",
    "dialog",
    "JSON",
    "stringify",
    "textEditor",
    "find",
    "preventDefault",
    "stopPropagation",
    "$",
    "target",
    "data",
    "window",
    "plugins",
    "module",
    "exports"
  ],
  "sources": [
    "roster.coffee"
  ],
  "sourcesContent": [
    "###\n * Federated Wiki : Roster Plugin\n *\n * Licensed under the MIT license.\n * https://github.com/fedwiki/wiki-plugin-roster/blob/master/LICENSE.txt\n###\n#\n# Sample Roster Accessing Code\n#\n# Any item that exploses a roster will be identifed with class \"roster-source\".\n# These items offer the method getRoster() for retrieving the roster object.\n# Convention has roster consumers looking left for the nearest (or all) such objects.\n#\n#     items = $(\".item:lt(#{$('.item').index(div)})\")\n#     if (sources = items.filter \".roster-source\").size()\n#       choice = sources[sources.length-1]\n#       roster = choice.getRoster()\n#\n# This simplified version might be useful from the browser's javascript inspector.\n#\n#     $('.roster-source').get(0).getRoster()\n\nincludes = {}\n\nescape = (text) ->\n  text\n    .replace /&/g, '&amp;'\n    .replace /</g, '&lt;'\n    .replace />/g, '&gt;'\n\n\nload_sites = (uri) ->\n  tuples = uri.split ' '\n  while tuples.length\n    site = tuples.shift()\n    wiki.neighborhoodObject.registerNeighbor site\n\nparse = ($item, item) ->\n  roster = {all: []}\n  category = null\n  lineup = []\n  marks = {}\n  lines = []\n\n  if $item?\n    $item.addClass 'roster-source'\n    $item.get(0).getRoster = -> roster\n\n  more = item.text.split /\\r?\\n/\n\n  flag = (site) ->\n    roster.all.push site\n    lineup.push site\n    br = if lineup.length >= 18\n      newline()\n    else\n      ''\n    \"<img class=\\\"remote\\\" src=\\\"#{wiki.site(site).flag()}\\\" title=\\\"#{site}\\\" data-site=\\\"#{site}\\\" data-slug=\\\"welcome-visitors\\\">#{br}\"\n\n  newline = ->\n    if lineup.length\n      [sites, lineup] = [lineup, []]\n      if category?\n        roster[category] ||= []\n        roster[category].push site for site in sites\n      \"\"\" <a class='loadsites' href= \"/#\" data-sites=\"#{sites.join ' '}\" title=\"add these #{sites.length} sites\\nto neighborhood\">Â»</a><br> \"\"\"\n    else\n      \"<br>\"\n\n  cat = (name) ->\n    category = name\n\n  includeRoster = (line, siteslug) ->\n    if marks[siteslug]?\n      return \"<span>trouble looping #{siteslug}</span>\"\n    else\n      marks[siteslug] = true\n    if includes[siteslug]?\n      [].unshift.apply more, includes[siteslug]\n      ''\n    else\n      [site, slug] = siteslug.split('/')\n      wiki.site(site).get \"#{slug}.json\", (error, page) ->\n      # $.getJSON \"//#{siteslug}.json\", (page) ->\n        if error\n          console.log \"unable to get #{siteslug}\"\n        else\n          includes[siteslug] = [\"<span>trouble loading #{siteslug}</span>\"]\n          for i in page.story\n            if i.type is 'roster'\n              includes[siteslug] = i.text.split /\\r?\\n/\n              break\n          $item.empty()\n          emit $item, item\n          bind $item, item\n      \"<span>loading #{siteslug}</span>\"\n\n  includeReferences = (line, siteslug) ->\n    if includes[siteslug]?\n      [].unshift.apply more, includes[siteslug]\n      ''\n    else\n      [site, slug] = siteslug.split('/')\n      wiki.site(site).get \"#{slug}.json\", (error, page) ->\n      # $.getJSON \"//#{siteslug}.json\", (page) ->\n        if error\n          console.log \"unable to get #{siteslug}\"\n        else\n          includes[siteslug] = []\n          for i in page.story\n            if i.type is 'reference'\n              includes[siteslug].push i.site if includes[siteslug].indexOf(i.site) < 0\n          $item.empty()\n          emit $item, item\n          bind $item, item\n      \"<span>loading #{siteslug}</span>\"\n\n  expand = (text) ->\n    text\n      .replace /^$/, newline\n      .replace /^([a-zA-Z0-9-]+(\\.[a-zA-Z0-9-]+)+)(:\\d+)?$/, flag\n      .replace /^localhost(:\\d+)?$/, flag\n      .replace /^ROSTER ([A-Za-z0-9.-:]+\\/[a-z0-9-]+)$/, includeRoster\n      .replace /^REFERENCES ([A-Za-z0-9.-:]+\\/[a-z0-9-]+)$/, includeReferences\n      .replace /^([^<].*)$/, cat\n\n  while more.length\n    lines.push expand more.shift()\n  lines.push newline()\n  lines.join ' '\n\nemit = ($item, item) ->\n  $item.append \"\"\"\n    <p style=\"background-color:#eee;padding:15px;\">\n      #{parse $item, item}\n    </p>\n  \"\"\"\n\nbind = ($item, item) ->\n  $item.on 'dblclick', (e) ->\n    if e.shiftKey\n      wiki.dialog \"Roster Categories\", \"<pre>#{JSON.stringify $item.get(0).getRoster(), null, 2}</pre>\"\n    else\n      wiki.textEditor $item, item\n  $item.find('.loadsites').on 'click', (e) ->\n    e.preventDefault()\n    e.stopPropagation()\n    console.log 'roster sites', $(e.target).data('sites').split(' ')\n    load_sites $(e.target).data('sites')\n\n\nwindow.plugins.roster = {emit, bind} if window?\nmodule.exports = {parse, includes} if module?\n"
  ],
  "mappings": "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"
}