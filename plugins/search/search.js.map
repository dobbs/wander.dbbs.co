{
  "version": 3,
  "names": [
    "bind",
    "emit",
    "expand",
    "text",
    "replace",
    "$item",
    "item",
    "flag",
    "handle",
    "keystroke",
    "parse",
    "report",
    "search",
    "status",
    "success",
    "twins",
    "slug",
    "site",
    "concat",
    "sites",
    "results",
    "i",
    "len",
    "length",
    "join",
    "result",
    "append",
    "find",
    "data",
    "elapsed",
    "Object",
    "keys",
    "request",
    "quickly",
    "url",
    "console",
    "log",
    "start",
    "Date",
    "now",
    "stop",
    "$",
    "post",
    "fail",
    "e",
    "responseText",
    "statusText",
    "empty",
    "input",
    "keyCode",
    "val",
    "match",
    "extend",
    "query",
    "on",
    "op",
    "toLowerCase",
    "wiki",
    "textEditor",
    "window",
    "plugins",
    "module",
    "exports"
  ],
  "sources": [
    "search.coffee"
  ],
  "sourcesContent": [
    "\nexpand = (text)->\n  text\n    .replace /&/g, '&amp;'\n    .replace /</g, '&lt;'\n    .replace />/g, '&gt;'\n    .replace /\\*(.+?)\\*/g, '<i>$1</i>'\n\nemit = ($item, item) ->\n\n  flag = (slug, site) ->\n    \"\"\"\n      <img class=\"remote\"\n        title=\"#{site}\"\n        src=\"http://#{site}/favicon.png\"\n        data-site=\"#{site}\"\n        data-slug=\"#{slug}\">\n    \"\"\"\n\n  twins = (slug, sites) ->\n    \"#{slug.replace(/-/g, ' ')}<br>#{(flag slug, site for site in sites).join(' ')}\"\n\n  report = (result) ->\n    (twins slug, sites for slug, sites of result).join('<br>')\n\n  $item.append if item.result?\n    \"<div class=report>#{report item.result}</div>\"\n  else\n    \"\"\"\n      <div style=\"width:93%; background:#eee; padding:16px; margin-bottom:5px; text-align: center;\">\n        <span>#{expand item.text}<br></span>\n        <p class=\"caption\">ready</p>\n        <div class=report style=\"text-align:left;\"></div>\n      </div>\n    \"\"\"\n\n  status = (text) ->\n    $item.find('p.caption').text text\n\n  success = (data, elapsed) ->\n    status \"#{Object.keys(data.result).length} titles, #{elapsed} sec\"\n    $item\n      .find('.report')\n      .append report data.result\n\n  search = (request) ->\n    url = \"http://#{item.site||'search.fed.wiki.org:3030'}/match\"\n    console.log 'search', request\n    quickly = () ->\n      start = Date.now()\n      (data) ->\n        stop = Date.now()\n        success data, (stop-start)/1000.0\n    $.post(url, request, quickly(), 'json')\n      .fail (e) -> status \"search failed: #{e.responseText || e.statusText}\"\n    $item.find('.report').empty()\n    status \"searching\"\n\n  keystroke = (e) ->\n    if e.keyCode == 13\n      input = $item.find('input').val()\n      if input.match /\\w/\n        request = $.extend({}, $item.request);\n        request.query += \" #{input}\"\n        search request\n\n  handle = (request) ->\n    if request.input\n      $item.request = request\n      $item\n        .find('span')\n        .append '<input type=text style=\"width: 95%;\"></input>'\n        .on 'keyup', keystroke\n    else if request.search\n      $item.request = request\n      $item\n        .find('span')\n        .append '<button>search</button>'\n        .on 'click', () -> search request\n    else\n      search request\n\n  parse = (text) ->\n    request = {}\n    text = text.replace /\\b(AND|OR)\\b/g, (op) ->\n      request.match = op.toLowerCase()\n      ''\n    text = text.replace /\\b(ALL)\\b/, (op) ->\n      request.match = 'and'\n      ''\n    text = text.replace /\\b(ANY)\\b/, (op) ->\n      request.match = 'or'\n      ''\n    text = text.replace /\\b(WORDS|LINKS|SITES|SLUGS|ITEMS|PLUGINS)\\b/g, (op) ->\n      request.find = op.toLowerCase()\n      ''\n    text = text.replace /\\b(INPUT)\\b/, (op) ->\n      request.input = true\n      ''\n    text = text.replace /\\b(SEARCH)\\b/, (op) ->\n      request.search = true\n      ''\n    request.query = text\n    request\n\n  handle parse item.text if item.text?\n\nbind = ($item, item) ->\n  $item.on 'dblclick', () -> wiki.textEditor $item, item\n  $item.find('input').on 'dblclick', () -> false\n\nwindow.plugins.search = {emit, bind} if window?\nmodule.exports = {expand} if module?\n\n"
  ],
  "mappings": "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"
}