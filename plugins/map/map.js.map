{
  "version": 3,
  "mappings": "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",
  "names": [
    "usePageMarkers",
    "escape",
    "line",
    "replace",
    "resolve",
    "text",
    "wiki",
    "resolveLinks",
    "htmlDecode",
    "escapedText",
    "doc",
    "DOMParser",
    "parseFromString",
    "documentElement",
    "textContent",
    "marker",
    "deg",
    "m",
    "num",
    "match",
    "decimal",
    "nautical",
    "exec",
    "lat",
    "lon",
    "label",
    "lineup",
    "$item",
    "lineupMarkers",
    "candidates",
    "$",
    "index",
    "who",
    "filter",
    "size",
    "concat",
    "div",
    "markerData",
    "page",
    "pageMarkers",
    "siblings",
    "parse",
    "item",
    "captions",
    "markers",
    "overlays",
    "boundary",
    "weblink",
    "tools",
    "frozen",
    "ref",
    "push",
    "hints",
    "hint",
    "test",
    "url",
    "bounds",
    "Array",
    "from",
    "Set",
    "map",
    "JSON",
    "stringify",
    "result",
    "caption",
    "join",
    "Object",
    "keys",
    "length",
    "feature",
    "type",
    "geometry",
    "coordinates",
    "properties",
    "emit",
    "addClass",
    "showing",
    "get",
    "opened",
    "s",
    "leaflet",
    "_popup",
    "_isOpen",
    "marlers",
    "markerGeo",
    "features",
    "appendTo",
    "getScript",
    "mapId",
    "Math",
    "floor",
    "random",
    "append",
    "L",
    "scrollWheelZoom",
    "update",
    "pageHandler",
    "put",
    "parents",
    "id",
    "doPlugin",
    "empty",
    "locate",
    "control",
    "position",
    "flyTo",
    "drawCircle",
    "drawMarker",
    "addTo",
    "search",
    "geocoder",
    "Control",
    "defaultMarkGeocode",
    "on",
    "e",
    "geocode",
    "center",
    "lng",
    "title",
    "name",
    "LatLngBounds",
    "results",
    "p",
    "pad",
    "flyToBounds",
    "zoom",
    "toFixed",
    "freeze",
    "freezeControl",
    "extend",
    "options",
    "onAdd",
    "container",
    "DomUtil",
    "create",
    "innerHTML",
    "newMarkers",
    "newMarkerGroup",
    "onclick",
    "shiftKey",
    "preventDefault",
    "stopPropagation",
    "toFreeze",
    "addEventListener",
    "l",
    "x",
    "has",
    "layerGroup",
    "forEach",
    "mark",
    "tmpBoundary",
    "remove",
    "latlng",
    "latLng",
    "onRemove",
    "addControl",
    "mapDiv",
    "DomEvent",
    "disableClickPropagation",
    "doubleClickZoom",
    "disable",
    "originalEvent",
    "tile",
    "tileCredits",
    "tileLayer",
    "attribution",
    "imageOverlay",
    "o",
    "opacity",
    "interactive",
    "openWeblink",
    "link",
    "target",
    "window",
    "open",
    "showMarkers",
    "markerLabel",
    "mkr",
    "bindPopup",
    "openPopup",
    "fitBounds",
    "setView",
    "regionData",
    "region",
    "getBounds",
    "north",
    "getNorth",
    "south",
    "getSouth",
    "east",
    "getEast",
    "west",
    "getWest",
    "bind",
    "dblclick",
    "textEditor",
    "plugins",
    "module",
    "exports"
  ],
  "sourceRoot": "",
  "sources": [
    "map.coffee"
  ],
  "sourcesContent": [
    "###\n * Federated Wiki : Map Plugin\n *\n * Licensed under the MIT license.\n * https://github.com/fedwiki/wiki-plugin-map/blob/master/LICENSE.txt\n###\n\n# page markers?\nusePageMarkers = false\n\nescape = (line) ->\n  line\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n\nresolve = (text) ->\n  if wiki?\n    wiki.resolveLinks(text, escape)\n  else\n    escape(text)\n      .replace(/\\[\\[.*?\\]\\]/g,'<internal>')\n      .replace(/\\[.*?\\]/g,'<external>')\n\nhtmlDecode = (escapedText) ->\n  doc = new DOMParser().parseFromString(escapedText, \"text/html\")\n  doc.documentElement.textContent\n\nmarker = (text) ->\n  deg = (m) ->\n    num = +m[0] + m[1]/60 + (m[2]||0)/60/60\n    if m[3].match /[SW]/i then -num else num\n  decimal = /^(-?\\d{1,3}\\.?\\d*)[, ] *(-?\\d{1,3}\\.?\\d*)\\s*(.*)$/\n  nautical = /^(\\d{1,3})°(\\d{1,2})'(\\d*\\.\\d*)?\"?([NS]) (\\d{1,3})°(\\d{1,2})'(\\d*\\.\\d*)?\"?([EW]) (.*)$/i\n  return {lat: +m[1], lon: +m[2], label: resolve(m[3])} if m = decimal.exec text\n  return {lat: deg(m[1..4]), lon: deg(m[5..8]), label: resolve(m[9])} if m = nautical.exec text\n  null\n\nlineup = ($item) ->\n  return [{lat: 51.5, lon: 0.0, label: 'North Greenwich'}] unless wiki?\n  lineupMarkers = []\n  candidates = $(\".item:lt(#{$('.item').index($item)})\")\n  if (who = candidates.filter \".marker-source\").size()\n    lineupMarkers = lineupMarkers.concat div.markerData() for div in who\n  lineupMarkers\n  \npage = ($item) ->\n  return [{lat: 51.5, lon: 0.0, label: 'North Greenwich'}] unless wiki?\n  pageMarkers = []\n  candidates = $item.siblings()\n  if (who = candidates.filter \".marker-source\").size()\n    pageMarkers = pageMarkers.concat div.markerData() for div in who\n  pageMarkers\n\nparse = (item, $item) ->\n  text = item.text\n  # parsing the plugin text in context of any frozen items\n  captions = []\n  markers = []\n  lineupMarkers = null\n  pageMarkers = null\n  overlays = null\n  boundary = null\n  weblink = null\n  tools = {}\n\n  usePageMarkers = false\n\n  if item.frozen\n    markers = markers.concat item.frozen\n  for line in text.split /\\n/\n    if m = marker line\n      m.weblink = weblink if weblink?\n      markers.push m\n    else if m = /^BOUNDARY *(.*)?$/.exec line\n      hints = if hint = marker m[1] then [hint] else []\n      boundary = markers.concat [] unless boundary?\n      boundary = boundary.concat hints\n    else if /^LINEUP/.test line\n      tools['freeze'] = true\n      lineupMarkers = lineup($item)\n      if !item.frozen\n        markers = markers.concat lineupMarkers\n    else if /^PAGE/.test line\n      tools['freeze'] = true\n      pageMarkers = page($item)\n      usePageMarkers = true\n      if !item.frozen\n        markers = markers.concat pageMarkers\n    else if m = /^WEBLINK *(.*)$/.exec line\n      weblink = m[1]\n    else if m = /^OVERLAY *(.+?) ([+-]?\\d+\\.\\d+), ?([+-]?\\d+\\.\\d+) ([+-]?\\d+\\.\\d+), ?([+-]?\\d+\\.\\d+)$/.exec line\n      overlays = (overlays||[]).concat {url:m[1], bounds:[[m[2],m[3]],[m[4],m[5]]]}\n    else if /^LOCATE/.test line\n      tools['locate'] = true\n    else if /^SEARCH/.test line\n      tools['search'] = true\n    else\n      captions.push resolve(line)\n\n  # remove any duplicate markers\n  markers = Array.from(new Set(markers.map(JSON.stringify))).map(JSON.parse)\n  lineupMarkers = Array.from(new Set(lineupMarkers.map(JSON.stringify))).map(JSON.parse) if lineupMarkers\n  pageMarkers = Array.from(new Set(pageMarkers.map(JSON.stringify))).map(JSON.parse) if pageMarkers\n\n  boundary = markers unless boundary?\n  result = {markers, caption: captions.join('<br>'), boundary}\n  result.lineupMarkers = lineupMarkers if lineupMarkers\n  result.pageMarkers = pageMarkers if pageMarkers\n  result.tools = tools if Object.keys(tools).length > 0\n  result.weblink = weblink if weblink?\n  result.overlays = overlays if overlays?\n  result\n\nfeature = (marker) ->\n  type: 'Feature'\n  geometry:\n    type: 'Point'\n    coordinates: [marker.lon, marker.lat]\n    properties:\n      label: marker.label\n\nemit = ($item, item) ->\n  {caption, markers, lineupMarkers, pageMarkers, boundary, weblink, overlays, tools} = parse item, $item\n\n  # announce our capability to produce markers in native and geojson format\n\n  $item.addClass 'marker-source'\n\n  showing = []\n  $item.get(0).markerData = ->\n    opened = showing.filter (s) -> s.leaflet._popup._isOpen\n    if opened.length\n      marlers = opened.map (s) -> s.marker\n    else\n      markers = parse(item, $item).markers\n    return markers\n\n  $item.get(0).markerGeo = ->\n    type: 'FeatureCollection'\n    features: parse(item, $item).markers.map(feature)\n\n  if (!$(\"link[href='https://unpkg.com/leaflet@1.7.1/dist/leaflet.css']\").length)\n    $('<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.7.1/dist/leaflet.css\">').appendTo(\"head\")\n  if (!$(\"link[href='/plugins/map/map.css']\").length)\n    $('<link rel=\"stylesheet\" href=\"/plugins/map/map.css\" type=\"text/css\">').appendTo(\"head\")\n\n  wiki.getScript \"https://unpkg.com/leaflet@1.7.1/dist/leaflet.js\", ->\n\n    mapId = \"map-#{Math.floor(Math.random()*1000000)}\"\n\n    $item.append \"\"\"\n      <figure style=\"padding: 8px;\">\n        <div id=\"#{mapId}\" style='height: 300px;'></div>\n        <p class=\"caption\">#{caption}</p>\n      </figure>\n    \"\"\"\n\n    map = L.map(mapId, {\n      scrollWheelZoom: false\n      })\n\n    update = ->\n      wiki.pageHandler.put $item.parents('.page:first'),\n        type: 'edit',\n        id: item.id,\n        item: item\n      wiki.doPlugin $item.empty(), item\n\n    # add locate control\n    if tools?.locate\n      if (!$(\"link[href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css']\").length)\n        $('<link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css\">').appendTo(\"head\")\n      if (!$(\"link[href='https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.72.0/dist/L.Control.Locate.min.css'\"))\n        $('<link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.72.0/dist/L.Control.Locate.min.css\">').appendTo(\"head\")\n      wiki.getScript \"https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.72.0/dist/L.Control.Locate.min.js\", ->\n        L.control.locate({\n          position: 'topleft'\n          flyTo: true\n          drawCircle: true\n          drawMarker: false}).addTo(map)\n\n    # add search control\n    if tools?.search\n      if (!$(\"link[href='https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css']\").length)\n        $('<link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css\" />').appendTo(\"head\")  \n      wiki.getScript \"https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js\", ->\n        geocoder = L.Control.geocoder({\n          defaultMarkGeocode: false\n        }).on('markgeocode', (e) ->\n          new L.marker([e.geocode.center.lat,e.geocode.center.lng],{\n            title: e.geocode.name\n          }).addTo(map)\n          boundary.push {\n            lat: e.geocode.center.lat\n            lon: e.geocode.center.lng}\n          if boundary.length > 1\n            bounds = new L.LatLngBounds [ [p.lat, p.lon] for p in boundary ]\n            bounds = bounds.pad(0.3)\n            map.flyToBounds bounds\n          else if boundary.length == 1\n            p = boundary[0]\n            map.flyTo([p.lat, p.lon], item.zoom || 13)\n          item.text +=\"\\n#{e.geocode.center.lat.toFixed 7}, #{e.geocode.center.lng.toFixed 7} #{e.geocode.name}\"\n          update()\n          ).addTo(map)\n\n    #\n    if tools?.freeze\n      freezeControl = L.Control.extend({\n        options: {\n          position: 'topright'\n        }\n\n        onAdd: (map) ->\n          container = L.DomUtil.create('div', 'leaflet-bar leaflet-control')\n          container.innerHTML = \"\"\"\n          <a class=\"leaflet-bar-part leaflet-bar-part-single\" href=\"#\" style=\"outline: currentcolor none medium;\">\n            <span style=#{item.frozen? 'color: black;' : 'color: blue;'}>❄︎</span>\n          </a>\n          \"\"\"\n\n          newMarkers = []\n          newMarkerGroup = null\n          \n          container.onclick = (e) ->\n            if e.shiftKey\n              e.preventDefault()\n              e.stopPropagation()\n              if item.frozen\n                delete item.frozen\n                update()\n            else\n              if usePageMarkers\n                pageMarkers = page($item)\n              toFreeze = []\n              if item.frozen\n                toFreeze = Array.from(new Set(item.frozen.concat(lineupMarkers||pageMarkers).map(JSON.stringify))).map(JSON.parse)\n              else\n                toFreeze = lineupMarkers||pageMarkers\n              # only update if there realy is something new to freeze or it has changed...\n              if (item.frozen and (toFreeze.length != item.frozen.length)) or (!item.frozen and toFreeze.length > 0)\n              #(!item.frozen and toFreeze.length > 0) or toFreeze.length != item.frozen.length\n                item.frozen = toFreeze\n                update()\n          \n          # mouse over will show any extra markers that will be added on a re-freeze.\n          container.addEventListener 'mouseenter', (e) ->\n            if usePageMarkers\n              pageMarkers = page($item)\n            m = new Set(markers.map(JSON.stringify))\n            l = new Set((lineupMarkers||pageMarkers).map(JSON.stringify))\n            newMarkers = Array.from(new Set(Array.from(l).filter((x) -> !m.has(x)))).map(JSON.parse)\n            if newMarkers.length > 0\n              newMarkerGroup = L.layerGroup().addTo(map)\n              newMarkers.forEach (mark) ->\n                L.marker([mark.lat, mark.lon]).addTo(newMarkerGroup)\n              tmpBoundary = boundary.concat newMarkers\n              bounds = new L.LatLngBounds [ [p.lat, p.lon] for p in tmpBoundary ]\n              bounds = bounds.pad(0.3)\n              map.flyToBounds bounds\n\n          container.addEventListener 'mouseleave', (e) ->\n            if newMarkers.length > 0\n              newMarkerGroup.remove()\n              if boundary.length > 1\n                bounds = new L.LatLngBounds [ [p.lat, p.lon] for p in boundary ]\n                bounds = bounds.pad(0.3)\n                map.flyToBounds bounds\n              else if boundary.length == 1\n                p = boundary[0]\n                map.flyTo([p.lat, p.lon], item.zoom || 13)\n              else\n                map.flyTo(item.latlng || item.latLng || [40.735383, -73.984655], item.zoom || 13)\n          \n          return container\n\n        onRemove: (map) ->\n          # Nothing to do here...\n\n      })\n      map.addControl(new freezeControl())\n\n\n    # stop dragging the map from propagating and dragging the page item.\n    mapDiv = L.DomUtil.get(\"#{mapId}\")\n    L.DomEvent.disableClickPropagation(mapDiv)\n\n    map.doubleClickZoom.disable()\n    map.on 'dblclick', (e) ->\n      if e.originalEvent.shiftKey\n        e.originalEvent.stopPropagation()\n        new L.marker(e.latlng).addTo(map)\n        item.text += \"\\n#{e.latlng.lat.toFixed 7}, #{e.latlng.lng.toFixed 7}\"\n        update()\n\n\n    # select tiles, default to OSM\n    tile = item.tile || \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n    tileCredits  = item.tileCredits || '© <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n\n    L.tileLayer(tile, {\n      attribution: tileCredits\n      }).addTo(map)\n\n    # add specialized map overlays\n    for o in overlays||[]\n      L.imageOverlay(o.url, o.bounds, {opacity:0.6, interactive:true}).addTo(map)\n\n    openWeblink = (e) ->\n      return unless link = e.target.options.weblink\n      window.open (link\n        .replace(/\\{LAT}/, e.latlng.lat)\n        .replace(/\\{(LON|LNG)}/, e.latlng.lng))\n\n    showMarkers = (markers) ->\n      return unless markers\n      for p in markers\n        markerLabel  = htmlDecode(wiki.resolveLinks(p.label))\n        mkr = L.marker([p.lat, p.lon], {weblink: p.weblink || weblink})\n          .on( 'dblclick', openWeblink)\n          .bindPopup( markerLabel )\n          .openPopup()\n          .addTo(map);\n        showing.push {leaflet:mkr, marker:p}\n\n    # add markers on the map\n    showMarkers markers\n\n    # center map on markers or item properties\n    if boundary.length > 1\n      bounds = new L.LatLngBounds [ [p.lat, p.lon] for p in boundary ]\n      bounds = bounds.pad(0.3)\n      map.fitBounds bounds\n    else if boundary.length == 1\n      p = boundary[0]\n      map.setView([p.lat, p.lon], item.zoom || 13)\n    else\n      map.setView(item.latlng || item.latLng || [40.735383, -73.984655], item.zoom || 13)\n\n    # announce our capability to produce a region\n\n    $item.addClass 'region-source'\n\n    $item.get(0).regionData = ->\n      region = map.getBounds()\n      return {\n        north: region.getNorth()\n        south: region.getSouth()\n        east: region.getEast()\n        west: region.getWest()\n      }\n\n\nbind = ($item, item) ->\n  $item.dblclick ->\n    wiki.textEditor $item, item\n\n\nwindow.plugins.map = {emit, bind} if window?\nmodule.exports = {marker, parse} if module?\n"
  ]
}