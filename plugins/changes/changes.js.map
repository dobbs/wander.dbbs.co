{
  "version": 3,
  "names": [
    "constructor",
    "escape",
    "listItemHtml",
    "pageBundle",
    "line",
    "replace",
    "slug",
    "title",
    "concat",
    "bundle",
    "i",
    "j",
    "length",
    "ref",
    "localStorage",
    "key",
    "JSON",
    "parse",
    "getItem",
    "$",
    "dependencies",
    "arguments",
    "undefined",
    "bind",
    "emit",
    "window",
    "$div",
    "item",
    "page",
    "ul",
    "append",
    "submit",
    "location",
    "hostname",
    "on",
    "siblings",
    "data",
    "removeItem",
    "empty",
    "ajax",
    "type",
    "url",
    "stringify",
    "success",
    "citation",
    "textStatus",
    "jqXHR",
    "before",
    "beforeElement",
    "itemElement",
    "pageElement",
    "wiki",
    "log",
    "site",
    "Exception",
    "parents",
    "attr",
    "id",
    "find",
    "doPlugin",
    "prev",
    "pageHandler",
    "put",
    "after",
    "error",
    "xhr",
    "msg",
    "anchor",
    "document",
    "createElement",
    "body",
    "appendChild",
    "setAttribute",
    "encodeURIComponent",
    "click",
    "removeChild",
    "count",
    "_",
    "size",
    "dialog",
    "text",
    "registerPlugin",
    "module",
    "exports"
  ],
  "sources": [
    "changes.coffee"
  ],
  "sourcesContent": [
    "###\n * Federated Wiki : Changes Plugin\n *\n * Licensed under the MIT license.\n * https://github.com/fedwiki/wiki-plugin-changes/blob/master/LICENSE.txt\n###\n\nescape = (line) ->\n  line\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n\nlistItemHtml = (slug, title)->\n  \"\"\"\n    <li>\n      <a class=\"internal\" href=\"#\" title=\"local\" data-page-name=\"#{slug}\" data-site=\"local\">#{escape title}</a>\n      <button class=\"delete\">âœ•</button>\n    </li>\n  \"\"\"\n\npageBundle = ->\n  bundle = {}\n  length = localStorage.length\n  for i in [0...length]\n    slug = localStorage.key i\n    bundle[slug] = JSON.parse localStorage.getItem slug\n  bundle\n\nconstructor = ($, dependencies={})->\n  localStorage = dependencies.localStorage || window.localStorage\n\n  emit = ($div, item) ->\n    if( localStorage.length == 0 )\n      $div.append( '<ul><p><i>no local changes</i></p></ul>' )\n      return\n\n    $div.append( ul = $('<ul />') )\n    for i in [0...localStorage.length]\n      slug = localStorage.key(i)\n      page = JSON.parse(localStorage.getItem(slug))\n      if page.title?\n        ul.append listItemHtml(slug,page.title)\n    if localStorage.length > 0\n      if item.submit?\n        ul.append \"\"\"<button class=\"submit\">Submit Changes</button>\"\"\"\n      else\n        $div.append \"\"\"\n          <p> Click <i>Export Changes</i> to download changed pages as <i>#{location.hostname}.json</i>.\n          Drag-and-drop this file to import pages elsewhere.</p>\n          <ul><button class=\"export\">Export Changes</button></ul>\n        \"\"\"\n\n  bind = ($div, item) ->\n    $div.on 'click', '.delete', ->\n      slug = $(this).siblings('a.internal').data('pageName')\n      localStorage.removeItem(slug)\n      emit( $div.empty(), item )\n\n    $div.on 'click', '.submit', ->\n      $.ajax\n        type: 'PUT'\n        url: \"/submit\"\n        data:\n          'bundle': JSON.stringify(pageBundle())\n        success: (citation, textStatus, jqXHR) ->\n          wiki.log \"ajax submit success\", citation, textStatus, jqXHR\n          throw new Exception \"Incomplete Submission\" unless citation.type and citation.site\n          pageElement = $div.parents('.page:first')\n          itemElement = $(\"<div />\", class: \"item #{citation.type}\").data('item',citation).attr('data-id', citation.id)\n          itemElement.data 'pageElement', pageElement\n          pageElement.find(\".story\").append(itemElement)\n          wiki.doPlugin itemElement, citation\n          beforeElement = itemElement.prev('.item')\n          before = wiki.getItem(beforeElement)\n          wiki.pageHandler.put pageElement, {item: citation, id: citation.id, type: \"add\", after: before?.id}\n        error: (xhr, type, msg) ->\n          wiki.log \"ajax error callback\", type, msg\n\n    $div.on 'click', '.export', ->\n      anchor = document.createElement('a')\n      document.body.appendChild(anchor)\n      anchor.setAttribute('href', 'data:text/json;charset=utf-8,' + encodeURIComponent(JSON.stringify(pageBundle())))\n      anchor.setAttribute('download', location.hostname + '.json')\n      anchor.click()\n      document.body.removeChild(anchor)\n\n    $div.on 'dblclick', () ->\n      bundle = pageBundle()\n      count = _.size(bundle)\n      wiki.dialog \"JSON bundle for #{count} pages\",  $('<pre/>').text(JSON.stringify(bundle, null, 2))\n\n  {\n    emit: emit\n    bind: bind\n  }\n\nwiki.registerPlugin( 'changes', constructor )\n\nmodule.exports = constructor if module?\n"
  ],
  "mappings": "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"
}