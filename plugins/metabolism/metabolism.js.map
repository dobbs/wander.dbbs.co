{
  "version": 3,
  "names": [
    "window",
    "plugins",
    "metabolism",
    "emit",
    "div",
    "item",
    "bind",
    "annotate",
    "attach",
    "avg",
    "calculate",
    "data",
    "input",
    "output",
    "query",
    "round",
    "sum",
    "addClass",
    "get",
    "radarData",
    "on",
    "e",
    "$",
    "triggerHandler",
    "target",
    "text",
    "search",
    "callback",
    "arguments",
    "length",
    "undefined",
    "elem",
    "i",
    "len",
    "new_data",
    "ref",
    "source",
    "wiki",
    "getDataNodes",
    "indexOf",
    "_",
    "select",
    "row",
    "Activity",
    "concat",
    "page",
    "j",
    "len1",
    "obj",
    "ref1",
    "Error",
    "s",
    "story",
    "type",
    "title",
    "choices",
    "k",
    "keys",
    "n",
    "trim",
    "split",
    "next",
    "Category",
    "v",
    "reduce",
    "toString",
    "match",
    "toFixed",
    "allocated",
    "dispatch",
    "lines",
    "list",
    "report",
    "done",
    "args",
    "color",
    "comment",
    "err",
    "hours",
    "line",
    "next_dispatch",
    "result",
    "value",
    "shift",
    "isNaN",
    "push",
    "MET",
    "results",
    "join",
    "_ref",
    "_ref2",
    "error",
    "message",
    "table",
    "html",
    "append",
    "textEditor"
  ],
  "sources": [
    "metabolism.coffee"
  ],
  "sourcesContent": [
    "###\n * Federated Wiki : Metabolism Plugin\n *\n * Licensed under the MIT license.\n * https://github.com/fedwiki/wiki-plugin-metabolism/blob/master/LICENSE.txt\n###\n\nwindow.plugins.metabolism =\n  emit: (div, item) ->\n  bind: (div, item) ->\n\n    data = []\n    input = {}\n    output = {}\n\n    div.addClass 'radar-source'\n    div.get(0).radarData = -> output\n    div.on 'mousemove', (e) -> $(div).triggerHandler('thumb', $(e.target).text())\n\n    # http://stella.laurenzo.org/2011/03/bulletproof-node-js-coding/\n\n    attach = (search,callback = ->) ->\n      for elem in wiki.getDataNodes div\n        if (source = $(elem).data('item')).text.indexOf(search) >= 0\n          new_data = _.select source.data, (row) -> row.Activity?\n          return callback new_data\n      $.get \"/data/#{search}\", (page) ->\n        throw new Error \"can't find dataset '#{s}'\" unless page\n        for obj in page.story\n          if obj.type == 'data' && obj.text? && obj.text.indexOf(search) >= 0\n            new_data = _.select obj.data, (row) -> row.Activity?\n            return callback new_data\n        throw new Error \"can't find dataset '#{s}' in '#{page.title}'\"\n\n\n    query = (s) ->\n      keys = s.trim().split ' '\n      choices = data\n      for k in keys\n        next if k == ' '\n        n = choices.length\n        choices = _.select choices, (row) ->\n          row.Activity.indexOf(k) >= 0 || row.Category.indexOf(k) >= 0\n        throw new Error \"Can't find #{k} in remaining #{n} choices\" if choices.length == 0\n      choices\n\n    sum = (v) ->\n      _.reduce v, (s,n) -> s += n\n\n    avg = (v) ->\n      sum(v)/v.length\n\n    round = (n) ->\n      return '?' unless n?\n      if n.toString().match /\\.\\d\\d\\d/\n        n.toFixed 2\n      else\n        n\n\n    annotate = (text) ->\n      return '' unless text?\n      \" <span title=\\\"#{text}\\\">*</span>\"\n\n    calculate = (item) ->\n      list = []\n      allocated = 0\n      lines = item.text.split \"\\n\"\n      report = []\n\n      dispatch = (list, allocated, lines, report, done) ->\n        color = '#eee'\n        value = comment = null\n        hours = ''\n        line = lines.shift()\n        return done report unless line?\n\n        next_dispatch = ->\n          list.push +value if value? and ! isNaN +value\n          report.push \"<tr style=\\\"background:#{color};\\\"><td style=\\\"width: 70%;\\\">#{line}#{annotate comment}<td>#{hours}<td><b>#{round value}</b>\"\n          dispatch list, allocated, lines, report, done\n\n        try\n          if args = line.match /^USE ([\\w ]+)$/\n            color = '#ddd'\n            value = ' '\n            return attach (line = args[1]), (new_data) ->\n              data = new_data\n              next_dispatch()\n          else if args = line.match /^([0-9.]+) ([\\w ]+)$/\n            allocated += hours = +args[1]\n            result = query line = args[2]\n            output[line] = value = (input = result[0]).MET * hours\n            if result.length > 1\n              comment = (\"#{row.Category} (#{row.MET}): #{row.Activity}\" for row in result).join \"\\n\\n\"\n          else if input[line]?\n            value = input[line]\n            comment = input[\"#{line} Assumptions\"] || null\n          else if line.match /^[0-9\\.-]+$/\n            value = +line\n          else if line == 'REMAINDER'\n            value = 24 - allocated\n            allocated += value\n          else if line == 'SUM'\n            color = '#ddd'\n            [value, list] = [sum(list), []]\n          else if line == 'AVG'\n            color = '#ddd'\n            [value, list] = [avg(list), []]\n          else\n            color = '#edd'\n        catch err\n          color = '#edd'\n          value = null\n          comment = err.message\n        return next_dispatch()\n\n      dispatch list, allocated, lines, report, (report) ->\n        text = report.join \"\\n\"\n        table = $('<table style=\"width:100%; background:#eee; padding:.8em;\"/>').html text\n        div.append table\n        div.on 'dblclick', () -> wiki.textEditor div, item\n\n    calculate item\n"
  ],
  "mappings": "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"
}